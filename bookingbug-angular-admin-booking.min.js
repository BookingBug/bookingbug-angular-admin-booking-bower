(function(){"use strict";var adminbookingapp;adminbookingapp=angular.module("BBAdminBooking",["BB","BBAdmin.Services","trNgGrid"]),angular.module("BBAdminBooking").config(function($logProvider){return $logProvider.debugEnabled(!0)}),angular.module("BBAdminBooking.Directives",[]),angular.module("BBAdminBooking.Services",["ngResource","ngSanitize","ngLocalData"]),angular.module("BBAdminBooking.Controllers",["ngLocalData","ngSanitize"]),adminbookingapp.run(function($rootScope,$log,DebugUtilsService,FormDataStoreService,$bbug,$document,$sessionStorage,AppConfig,AdminLoginService){return AdminLoginService.checkLogin().then(function(){return $rootScope.user&&$rootScope.user.company_id?($rootScope.bb||($rootScope.bb={}),$rootScope.bb.company_id=$rootScope.user.company_id):void 0})})}).call(this),function(){"use strict";angular.module("BBAdminBooking").directive("bbAdminBookingClients",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"adminBookingClients"}}),angular.module("BBAdminBooking").controller("adminBookingClients",function($scope,$rootScope,$q,AdminClientService,ClientDetailsService,AlertService,ClientService,ValidatorService,ErrorService,$log,PaginationService){return $scope.validator=ValidatorService,$scope.clientDef=$q.defer(),$scope.clientPromise=$scope.clientDef.promise,$scope.per_page=20,$scope.total_entries=0,$scope.clients=[],$scope.search_clients=!1,$scope.newClient=!1,$scope.no_clients=!1,$scope.search_error=!1,$scope.search_text=null,$scope.pagination=PaginationService.initialise({page_size:10,max_size:5}),$scope.showSearch=function(_this){return function(){return $scope.search_clients=!0,$scope.newClient=!1}}(this),$scope.showClientForm=function(_this){return function(){return $scope.search_error=!1,$scope.no_clients=!1,$scope.search_clients=!1,$scope.newClient=!0,$scope.clearClient()}}(this),$scope.selectClient=function(_this){return function(client,route){return $scope.search_error=!1,$scope.no_clients=!1,$scope.setClient(client),$scope.client.setValid(!0),$scope.decideNextPage(route)}}(this),$scope.checkSearch=function(_this){return function(){return $scope.search_text&&$scope.search_text.length>=3?($scope.search_error=!1,!0):($scope.search_error=!0,!1)}}(this),$scope.createClient=function(_this){return function(route){return $scope.notLoaded($scope),$scope.bb&&$scope.bb.parent_client&&($scope.client.parent_client_id=$scope.bb.parent_client.id),$scope.client_details&&$scope.client.setClientDetails($scope.client_details),ClientService.create_or_update($scope.bb.company,$scope.client).then(function(client){return $scope.setLoaded($scope),$scope.selectClient(client,route)},function(err){return $scope.setLoadedAndShowError($scope,err,"Sorry, something went wrong")})}}(this),$scope.getClients=function(currentPage,filterBy,filterByFields,orderBy,orderByReverse){var clientDef,params;return AlertService.clear(),$scope.search_triggered=!0,$scope.no_clients=!1,$scope.search_error=!1,clientDef=$q.defer(),params={company:$scope.bb.company,per_page:$scope.per_page,filter_by:null!=filterBy?filterBy:$scope.search_text,filter_by_fields:filterByFields,order_by:orderBy,order_by_reverse:orderByReverse},currentPage&&(params.page=currentPage+1),$scope.notLoaded($scope),!$rootScope.bb.api_url&&$scope.bb.api_url&&($rootScope.bb.api_url=$scope.bb.api_url),AdminClientService.query(params).then(function(_this){return function(clients){return $scope.clients=clients.items,$scope.setLoaded($scope),$scope.setPageLoaded(),$scope.total_entries=clients.total_entries,PaginationService.update($scope.pagination,$scope.clients.length),clientDef.resolve(clients.items)}}(this))},$scope.searchClients=function(search_text){var clientDef,params;return clientDef=$q.defer(),params={filter_by:search_text,company:$scope.bb.company},AdminClientService.query(params).then(function(_this){return function(clients){return clientDef.resolve(clients.items),clients.items}}(this)),clientDef.promise},$scope.typeHeadResults=function($item,$model,$label){var item,label,model;item=$item,model=$model,label=$label,$scope.client=item},$scope.clearSearch=function(){return $scope.clients=null,$scope.search_triggered=!1},$scope.edit=function(item){return $log.info("not implemented")}})}.call(this),function(){angular.module("BBAdminBooking").directive("bbAdminBooking",function(AdminCompanyService,$log,$compile,$q,PathSvc,$templateCache,$http){var getTemplate,link,renderTemplate;return getTemplate=function(template){var fromTemplateCache,partial,src;return partial=template?template:"main",fromTemplateCache=$templateCache.get(partial),fromTemplateCache?fromTemplateCache:(src=PathSvc.directivePartial(partial).$$unwrapTrustedValue(),$http.get(src,{cache:$templateCache}).then(function(response){return response.data}))},renderTemplate=function(scope,element,design_mode,template){return $q.when(getTemplate(template)).then(function(template){return element.html(template).show(),design_mode&&element.append("<style widget_css scoped></style>"),$compile(element.contents())(scope)})},link=function(scope,element,attrs){var config;return config=scope.$eval(attrs.bbAdminBooking),config||(config={}),config.admin=!0,attrs.companyId||(config.company_id?attrs.companyId=config.company_id:scope.company&&(attrs.companyId=scope.company.id)),attrs.companyId?AdminCompanyService.query(attrs).then(function(company){return scope.company=company,scope.initWidget(config),renderTemplate(scope,element,config.design_mode,config.template)}):void 0},{link:link,controller:"BBCtrl"}})}.call(this),function(){angular.module("BBAdminBooking").directive("bbAdminBookingPopup",function(AdminBookingPopup){var controller,link;return controller=function($scope){return $scope.open=function(){return AdminBookingPopup.open()}},link=function(scope,element,attrs){return element.bind("click",function(){return scope.open()})},{link:link,controller:controller}})}.call(this),function(){angular.module("BBAdminBooking").factory("AdminBookingPopup",function($modal,$timeout){return{open:function(config){return $modal.open({size:config?config.size:"lg",controller:function($scope,$modalInstance,config){var base;return $scope.bb&&$scope.bb.current_item&&delete $scope.bb.current_item,$scope.config=angular.extend({clear_member:!0,template:"main"},config),$scope.company&&((base=$scope.config).company_id||(base.company_id=$scope.company.id)),$scope.config.item_defaults=angular.extend({merge_resources:!0,merge_people:!1},config.item_defaults),$scope.cancel=function(){return $modalInstance.dismiss("cancel")}},templateUrl:"admin_booking_popup.html",resolve:{config:function(){return config}}})}}})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;window.Collection.Client=function(superClass){function Client(){return Client.__super__.constructor.apply(this,arguments)}return extend(Client,superClass),Client.prototype.checkItem=function(item){return Client.__super__.checkItem.apply(this,arguments)},Client}(window.Collection.Base),angular.module("BB.Services").provider("ClientCollections",function(){return{$get:function(){return new window.BaseCollections}}})}.call(this);